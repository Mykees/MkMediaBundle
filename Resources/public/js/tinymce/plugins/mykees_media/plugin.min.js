(function(){
    tinymce.create('tinymce.plugins.image',{
        init: function(ed,url){
            ed.addCommand('open_image', function(){
                var url = ed.settings.image_explorer;
                var elem = ed.selection.getNode();
                if(elem.nodeName == "IMG"){
                    url = ed.settings.image_editor;
                    url+= '?src='+encodeURIComponent(ed.dom.getAttrib(elem,'src'))+"&alt="+ed.dom.getAttrib(elem,'alt')+'&class='+ed.dom.getAttrib(elem,'class');
                }
                ed.windowManager.open({
                    url : url,
                    id: 'image',
                    width: 1300,
                    height: 600,
                    inline: true,
                    title: 'Insérer une image'
                },{
                    custom_param : 1
                });
            });
            ed.addButton('image',{
                title : 'Insérer une image',
                cmd : 'open_image'
            })
        }
    });
    tinymce.PluginManager.add('image',tinymce.plugins.image);
})();